async function apiRequest(method,url,body){const headers={'Content-Type':'application/json'};const token=localStorage.getItem('token');if(token){headers['Authorization']='Bearer '+token}const res=await fetch(url,{method,headers,body:body?JSON.stringify(body):undefined});if(res.status===401){localStorage.removeItem('token');window.location.href='index.html';return}let data=null;try{data=await res.json()}catch(e){}if(!res.ok){const err=(data&&data.message)||'Error en la solicitud';throw new Error(err)}return data}